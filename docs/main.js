(()=>{"use strict";class e{static getNotesFromLocalStorage(){return localStorage.notes||(localStorage.notes="[]"),JSON.parse(localStorage.notes)}static writeNoteToLocalStorage(t){const o=e.getNotesFromLocalStorage();o.push(t),localStorage.notes=JSON.stringify(o),e.renderNoteHTML(t)}static renderNotesFromLocalStorage(){e.getNotesFromLocalStorage().forEach((t=>{e.renderNoteHTML(t)}))}static removeFromLocalStorage(t){const o=t.dataset.noteId,a=e.getNotesFromLocalStorage().filter((e=>e.id!==+o));localStorage.notes=JSON.stringify(a)}static generateNoteId(){const t=[];e.getNotesFromLocalStorage().forEach((e=>{e&&t.push(e.id)}));let o=1;for(;t.includes(o);)o++;return o}static renderNoteHTML(t){const o=document.querySelector(".timeline__line"),a=document.createElement("div"),l=document.createElement("span"),r=document.createElement("p"),n=document.createElement("span"),s=document.createElement("a");a.className="note-container",a.dataset.noteId=t.id,l.className="note-date",l.textContent=t.date,r.className="note-text",r.textContent=t.inputText,n.className="note-coords",n.textContent=t.coords,s.className="note-close",s.innerHTML="&#9587;",a.addEventListener("click",(t=>{"note-close"===t.target.className&&(e.removeFromLocalStorage(t.currentTarget),t.currentTarget.remove())})),a.appendChild(s),a.appendChild(l),a.appendChild(r),a.appendChild(n),o.appendChild(a)}}class t{constructor(e,t,o,a){this.latitude=e,this.longitude=t,this.modalWrapper=o,this.inputText=a,this.date=new Date,this.checkCoords(),this.refuctoringNoteObj()}checkCoords(){this.parseDate(),this.latitude||this.longitude||this.modalWrapper.classList.toggle("hidden")}parseDate(){const e=this.date.getFullYear();let t=this.date.getMonth()+1,o=this.date.getDate(),a=this.date.getHours(),l=this.date.getMinutes();1===t.toString().length&&(t=`0${t}`),1===o.toString().length&&(o=`0${o}`),1===a.toString().length&&(a=`0${a}`),1===l.toString().length&&(l=`0${l}`),this.date=`${a}:${l} ${o}.${t}.${e}`}refuctoringNoteObj(){this.coords=`[${this.latitude}, ${this.longitude}]`,this.id=e.generateNoteId(),delete this.latitude,delete this.longitude,delete this.modalWrapper}}window.addEventListener("DOMContentLoaded",(()=>{e.renderNotesFromLocalStorage();const o=document.querySelector(".timeline__text"),a=document.querySelector(".timeline__line"),l=document.querySelector(".timeline__form"),r=document.querySelector(".modal__wrapper"),n=document.querySelector(".modal__form"),s=document.querySelector(".modal__input"),i=navigator.geolocation;let c=null,d=null,u=null;a.scrollTop=a.scrollHeight,i.getCurrentPosition((e=>{({latitude:c,longitude:d}=e.coords)}),(e=>{console.log(e.message)})),l.addEventListener("submit",(l=>{l.preventDefault();const n=o.value;n?(u=new t(c,d,r,n),"[null, null]"!==u.coords&&(e.writeNoteToLocalStorage(u),o.value="",a.scrollTop=a.scrollHeight)):alert("Поле текст, пустое!")})),n.addEventListener("submit",(t=>{if(t.preventDefault(),s.setCustomValidity(""),!s.validity.valueMissing&&s.checkValidity())return u.coords=`[${s.value}]`,s.value="",r.classList.toggle("hidden"),e.writeNoteToLocalStorage(u),a.scrollTop=a.scrollHeight,void(o.value="");var l;(l=s).checkValidity()||l.setCustomValidity("Координаты не соответствуют шаблону"),l.validity.valueMissing&&l.setCustomValidity("Введите координаты в поле"),l.reportValidity()})),n.addEventListener("click",(e=>{e.target.classList.contains("modal_denied-btn")&&(s.value="",r.classList.toggle("hidden"))}))}))})();